{"version":3,"sources":["../src/startpayment.js"],"names":["getSelectedPaymentMethod","el","document","querySelector","value","startPayment","selector","addEventListener","e","preventDefault","dataset","currentTarget","Repository","createPayment","component","paymentarea","itemid","description","then","result","success","window","location","href","redirecturl","str","get_strings","key","strings","Notification","alert","message","Promise","resolve","fail","exception"],"mappings":"kfAwBA,OACA,OACA,O,siBAOA,QAASA,CAAAA,CAAT,EAAoC,CAChC,GAAIC,CAAAA,CAAE,CAAGC,QAAQ,CAACC,aAAT,CAAuB,gDAAvB,CAAT,CACA,GAAkB,WAAd,QAAOF,CAAAA,CAAP,EAAoC,IAAP,GAAAA,CAAjC,CAA8C,CAC1C,MAAOA,CAAAA,CAAE,CAACG,KACb,CACD,MAAO,KACV,C,eAQ2B,QAAfC,CAAAA,YAAe,CAACC,CAAD,CAAc,CACtCJ,QAAQ,CAACC,aAAT,CAAuBG,CAAvB,EAAiCC,gBAAjC,CAAkD,OAAlD,CAA2D,SAAAC,CAAC,CAAI,CAC5DA,CAAC,CAACC,cAAF,GACA,GAAMC,CAAAA,CAAO,CAAGF,CAAC,CAACG,aAAF,CAAgBD,OAAhC,CAEAE,CAAU,CAACC,aAAX,CACQH,CAAO,CAACI,SADhB,CAEQJ,CAAO,CAACK,WAFhB,CAGQL,CAAO,CAACM,MAHhB,CAIQN,CAAO,CAACO,WAJhB,CAKQjB,CAAwB,EALhC,CAMQ,IANR,EAOEkB,IAPF,CAOO,SAAAC,CAAM,CAAI,CACb,GAAIA,CAAM,CAACC,OAAX,CAAoB,CAChBC,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAuBJ,CAAM,CAACK,WACjC,CAFD,IAEO,CACHC,CAAG,CAACC,WAAJ,CAAgB,CACR,CAACC,GAAG,CAAE,2BAAN,CAAmCb,SAAS,CAAE,cAA9C,CADQ,CAER,CAACa,GAAG,CAAE,+BAAN,CAAuCb,SAAS,CAAE,cAAlD,CAFQ,CAAhB,EAGGI,IAHH,CAGQ,SAAAU,CAAO,CAAI,CACfC,CAAY,CAACC,KAAb,CAAmBF,CAAO,CAAC,CAAD,CAA1B,CAA+BT,CAAM,CAACY,OAAtC,CAA+CH,CAAO,CAAC,CAAD,CAAtD,CACH,CALD,CAMH,CACD,MAAOI,CAAAA,OAAO,CAACC,OAAR,EACV,CAnBD,EAmBGC,IAnBH,CAmBQL,CAAY,CAACM,SAnBrB,CAoBH,CAxBD,CAyBH,C","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Payment implementation for mollie system.\n *\n * @package    paygw_mollie\n * @module     paygw_mollie/startpayment\n * @copyright  2021 Ing. R.J. van Dongen <rogier@sebsoft.nl>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport * as Repository from 'paygw_mollie/repository';\nimport * as Notification from 'core/notification';\nimport * as str from 'core/str';\n\n/**\n * Detect selected payment method (if we have one).\n *\n * @returns {String|null}\n */\nfunction getSelectedPaymentMethod() {\n    let el = document.querySelector('input[name=\"method\"][type=\"radio\"]:checked');\n    if (typeof el !== 'undefined' && el !== null) {\n        return el.value;\n    }\n    return null;\n}\n\n/**\n * Create payment in the backend and redirect.\n *\n * @param {String} selector\n * @returns {Promise}\n */\nexport const startPayment = (selector) => {\n    document.querySelector(selector).addEventListener('click', e => {\n        e.preventDefault();\n        const dataset = e.currentTarget.dataset;\n\n        Repository.createPayment(\n                dataset.component,\n                dataset.paymentarea,\n                dataset.itemid,\n                dataset.description,\n                getSelectedPaymentMethod(),\n                null,\n        ).then(result => {\n            if (result.success) {\n                window.location.href = result.redirecturl;\n            } else {\n                str.get_strings([\n                        {key: 'startpayment:failed:title', component: 'paygw_mollie'},\n                        {key: 'startpayment:failed:btncancel', component: 'paygw_mollie'},\n                ]).then(strings => {\n                    Notification.alert(strings[0], result.message, strings[1]);\n                });\n            }\n            return Promise.resolve();\n        }).fail(Notification.exception);\n    });\n};\n"],"file":"startpayment.min.js"}